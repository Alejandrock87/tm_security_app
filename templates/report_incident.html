{% extends "base.html" %}

{% block styles %}
  {{ super() }}
  <link rel="stylesheet" href="{{ url_for('static', filename='css/report_incident.css') }}">
{% endblock %}

{% block content %}
<div class="main-content report-incident">
  <div class="report-container">
    <div class="report-header">
      <div class="report-header-icon">
        <i class="fas fa-exclamation-triangle"></i>
      </div>
      <h1 class="report-header-title">Reportar Incidente</h1>
    </div>
    <div class="report-content">
      <!-- Sección del formulario -->
      <div class="report-form-section">
        <div class="report-form-card">           
          <div class="report-form-body">
            <form method="post" class="report-form">
              {{ form.hidden_tag() }}
              <input type="hidden" id="latitude" name="latitude">
              <input type="hidden" id="longitude" name="longitude">
              <input type="hidden" id="nearest_station" name="nearest_station">
              
              <div class="form-group">
                {{ form.incident_type.label(class="form-label") }}
                {{ form.incident_type(class="form-select") }}
              </div>
              
              <div class="form-group">
                {{ form.description.label(class="form-label") }}
                {{ form.description(class="form-control", rows="4") }}
              </div>
              
              <div class="date-time-group">
                <div class="form-group">
                  {{ form.incident_date.label(class="form-label") }}
                  {{ form.incident_date(class="form-control", type="date") }}
                </div>
                <div class="form-group">
                  {{ form.incident_time.label(class="form-label") }}
                  {{ form.incident_time(class="form-control", type="time") }}
                </div>
              </div>
              
              <div class="form-group">
                {{ form.station.label(class="form-label") }}
                {{ form.station(class="form-select", onchange="handleStationChange(this.value)") }}
              </div>
              
              <div id="location-status" class="alert alert-info" role="alert">
                <i class="fas fa-location-arrow"></i> Obteniendo tu ubicación...
              </div>
              
              <div id="nearest-station-info" class="alert alert-success">
                <i class="fas fa-info-circle"></i> La estación más cercana se selecciona automáticamente según tu ubicación, pero puedes cambiarla si el incidente ocurrió en otra estación. La fecha y hora actual se establecen por defecto, pero pueden modificarse.
              </div>
              
              <div class="map-container">
                <div id="report-map"></div>
              </div>
              
              <button type="submit" class="submit-button" id="submit-button" disabled>
                <i class="fas fa-exclamation-triangle"></i> Reportar Incidente
              </button>
            </form>
          </div>
        </div>
      </div>
      
      <!-- Sección de leyendas/información -->
      <div class="legend-section">
        <div class="legend-card">
          <div class="legend-header">
            <h5 class="legend-title">
              <i class="fas fa-chart-bar"></i> Niveles de Inseguridad
            </h5>
          </div>
          <div class="legend-body">
            <div class="legend-item">
              <div class="legend-color" style="background-color: #ff0000;"></div>
              <span>Alto (>5 incidentes/mes)</span>
            </div>
            <div class="legend-item">
              <div class="legend-color" style="background-color: #ffa500;"></div>
              <span>Medio (2-5 incidentes/mes)</span>
            </div>
            <div class="legend-item">
              <div class="legend-color" style="background-color: #008000;"></div>
              <span>Bajo (<2 incidentes/mes)</span>
            </div>
          </div>
        </div>
        
        <div class="legend-card info-card">
          <div class="legend-body">
            <h6 class="legend-subtitle">
              <i class="fas fa-info-circle"></i> Información
            </h6>
            <p class="legend-text">
              Los niveles de inseguridad se calculan basándose en la cantidad de incidentes reportados en el último mes.
            </p>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
<script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
<script>
  // El código JavaScript se mantiene sin cambios
</script>
{% endblock %}